<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LIKWID: Build and install instructions</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">LIKWID
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Build and install instructions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="allg"></a>
Introduction</h2>
<p>Likwid is build using GNU make and Perl. Besides the Linux kernel and the standard C library, all required dependencies are shipped with the archive (<a href="http://www.lua.org/">Lua</a> and <a href="http://www.open-mpi.org/projects/hwloc/">hwloc</a>). It should build on any Linux distribution with a recent GCC compiler or CLANG compiler and 2.6 or newer kernel without any changes.</p>
<p>There is one generic top level Makefile and one .mk configuration file for each compiler (at the moment GCC, CLANG and ICC). Please note that we test LIKWID only with GCC. CLANG and ICC is only tested for basic functionality.</p>
<p>There is one exception: If you want to use LIKWID on a Intel Xeon Phi card you have to choose the MIC as compiler in config.mk, which is based on Intel ICC compiler.</p>
<h3><a class="anchor" id="directory"></a>
Directory structure</h3>
<p>All source files are in the src/ directory. All header files are located in src/includes/ . Lua application source files are in src/applications/. All external tools, namely HWLOC and Lua, are located in ext/. The bench/ folder contains all files of the benchmarking suite of LIKWID.</p>
<p>All build products are generated in the directory ./TAG, where TAG is the compiler configuration, default ./GCC.</p>
<h3><a class="anchor" id="config"></a>
Configuration</h3>
<p>Usually the only thing you have to configure is the PREFIX install path in the build config file config.mk in the top directory.</p>
<h4><a class="anchor" id="color"></a>
Changing color of &lt;CODE&gt;likwid-pin&lt;/CODE&gt; output</h4>
<p>Depending on the background of your terminal window you can choose a color for <code>likwid-pin</code> output.</p>
<h4><a class="anchor" id="accessD"></a>
Usage of the access daemon likwid-accessD</h4>
<p>Usually on your own system, you can use LIKWID with direct access to the MSR files. If you install LIKWID on a shared system as a HPC compute cluster you may consider to use the access daemon. This is a proxy application which was implemented with security in mind and performs address checks for allowed access. Using the access daemon, the measurements involve more overhead, especially if you use <a class="el" href="likwid-perfctr.html"><code>likwid-perfctr</code></a> in timeline mode or with the marker API.</p>
<p>To enable using the access daemon, configure in config.mk:</p>
<ul>
<li>Set BUILDDAEMON to true</li>
<li>Configure the path to the accessDaemon binary at ACCESSDAEMON</li>
<li>Set the ACCESSMODE to accessdaemon</li>
</ul>
<p>ACCESSMODE can be direct, accessdaemon and sysdaemon (not yet officially supported). You can overwrite the default setting on the command line using the -M switch.</p>
<p>If you want to access Uncore performance counters that are located in the PCI memory range, like they are implemented in Intel SandyBridge EP and IvyBridge EP, you have to use the access daemon or have root privileges because access to the PCI space is only permitted for highly privileged users.</p>
<h4><a class="anchor" id="setfreqinstall"></a>
Usage of frequency daemon likwid-setFreq</h4>
<p>The application <a class="el" href="likwid-setFrequencies.html"><code>likwid-setFrequencies</code></a> uses another daemon to modify the frequency of CPUs. The daemon is build and later installed if BUILDFREQ is set to true in config.mk.</p>
<h4><a class="anchor" id="sharedlib"></a>
Build Likwid as shared library</h4>
<p>Per default the LIKWID library is build as a shared library. You need the library if you want to use the Marker API. You can also use the LIKWID modules like <em>perfmon</em> directly. This is still not officially supported at the moment. In some settings it is necessary to build LIKWID as a shared library. To do so set SHARED_LIBRARY to true.</p>
<h4><a class="anchor" id="instr_bench"></a>
Instrument likwid-bench for usage with likwid-perfctr</h4>
<p><a class="el" href="likwid-bench.html"><code>likwid-bench</code></a> is instrumented for use with <a class="el" href="likwid-perfctr.html"><code>likwid-perfctr</code></a>. This allows you to measure various metrics of your <a class="el" href="likwid-bench.html"><code>likwid-bench</code></a> kernels. Enable instrumentation by setting INSTRUMENT_BENCH to true in config.mk.</p>
<h4><a class="anchor" id="fortran"></a>
Enabling Fortran interface for marker API</h4>
<p>If you want to use the Marker API in Fortran programs LIKWID offers a native Fortran90 interface. To enable it set FORTRAN_INTERFACE to true in config.mk.</p>
<h3><a class="anchor" id="targets"></a>
Build targets</h3>
<p>You have to edit config.mk to configure your build and install path.</p>
<p>The following make targets are available:</p>
<ul>
<li><b>make</b> - Build everything</li>
<li><b>make likwid-bench</b> - Build likwid-bench</li>
<li><b>make likwid-accessD</b> - Build likwid-accessD</li>
<li><b>make likwid-setFreq</b> - Build likwid-setFreq</li>
<li><b>make docs</b> - Create HTML documentation using doxygen</li>
<li><b>make clean</b> - Remove the object file directory *./GCC*, keep the executables</li>
<li><b>make distclean</b> - Remove all generated files</li>
<li><b>make local</b> - Adjust paths in Lua scripts to work from the build directory. Requires the daemons and the pinning library to be already installed. Mainly used for testing.</li>
</ul>
<p>The build system has a working dependency tracking, therefore <b>make clean</b> is only needed if you change the Makefile configuration.</p>
<h3><a class="anchor" id="installtargets"></a>
Installing</h3>
<p>NOTE: The pinning functionality and the daemons only work if configured in config.mk and installed with <b>make install</b>. If you do not use the pinning functionality the tools can be used without installation.</p>
<ul>
<li><b>make install</b> - Installs the executables, libraries, man pages and headers to the path you configured in config.mk.</li>
<li><b>make uninstall</b> - Delete all installed files.</li>
</ul>
<h3><a class="anchor" id="accessD"></a>
Usage of the access daemon likwid-accessD</h3>
<p>Hardware performance monitoring on x86 is enabled using model-specific registers (MSR). MSR registers are special registers not part of the instruction set architecture. To read and write to these registers the x86 ISA provides special instructions. These instructions can only be executed in protected mode or in other words only kernel code can execute these instructions. Fortunately, any Linux kernel 2.6 or newer provides access to these registers via a set of device files. This allows to implement all of the functionality in user space. Still it does not allow to use those more advanced features of hardware performance monitoring which require to setup interrupt service routines or kernel located memory.</p>
<p>Per default only root has read/write access to these msr device files. In order to use the LIKWID tools, which need access to these files (likwid-perfctr, likwid-powermeter and likwid-agent) as standard user, you need to setup access rights to these files.</p>
<p>likwid-perfctr, likwid-powermeter and likwid-features require the Linux <code>msr</code> kernel module. This module is part of most standard distro kernels. You have to be root to do the initial setup.</p>
<ul>
<li>Check if the <code>msr</code> module is loaded with <code>lsmod | grep msr</code>. There should be an output.</li>
<li>It the module is not loaded, load it with <code>modprobe msr</code>. For automatic loading at startup consult your distros documentation how to do so.</li>
<li>Adopt access rights on the MSR device files for normal user. To grant access to anyone, you can use <code>chmod o+rw /dev/cpu/*/msr</code>. This is only recommended on single user desktop systems.</li>
</ul>
<p>As in general access to MSRs is not desired on security sensitive systems, you can either implement a more sophisticated access rights settings with e.g. setgid. A common solution used on many other device files, e.g. for audio, is to introduce a group and make a <code>chown</code> on the msr device files to that group. Now if you execute likwid-perfctr with setgid on that group, the executing user can use the tool but cannot directly write or read the MSR device files.</p>
<p>Some distributions backported the capabilities check for the msr device to older kernels. If there are problems with accessing the msr device for older kernels with file system permissions set to read&amp;write, please check your kernel code (<code>arch/x86/kernel/msr.c</code>) for the backport and set the MSR capabilities in case.</p>
<p>A secure solution is to use the access daemon <a class="el" href="likwid-accessD.html"><code>likwid-accessD</code></a>, which encapsulates the access to the MSR device files and performs a address check for allowed registers.</p>
<p>Some newer kernels implement the so-called capabilities, a fine-grained permission system that can allow access to the MSR files for common users. On the downside it may be not enough anymore to set the suid-root flag for the access daemon, the executable must be registerd at the <code>libcap</code>.</p>
<p><code>sudo setcap cap_sys_rawio+ep EXECUTABLE</code></p>
<p>This is only possible on local file systems. A feasible way is to use the <a class="el" href="likwid-accessD.html"><code>likwid-accessD</code></a> for all accesses and just enable the capabilities for this one binary. This will enable the usage for all LIKWID tools and also for all instrumented binaries. If <a class="el" href="likwid-perfctr.html"><code>likwid-perfctr</code></a> utility should only be used in wrapper mode, it is suitable to set the capabilities for <a class="el" href="likwid-perfctr.html"><code>likwid-perfctr</code></a> only. Please remember to set the file permission of the MSR device files to read/write for all users, even if capabilites are configured correctly.</p>
<h4><a class="anchor" id="depends"></a>
Dependencies</h4>
<p>Although we tried to minimize the external dependencies of LIKWID, some advanced tools or only specific tool options require external packages.<br/>
 <a class="el" href="likwid-perfscope.html"><code>likwid-perfscope</code></a> uses the Perl script <a href="https://github.com/dkogan/feedgnuplot">feedGnuplot</a> to forward the real-time data to gnuplot. <a href="https://github.com/dkogan/feedgnuplot">feedGnuplot</a> is included into LIKWID, but <a href="http://www.gnuplot.info/">gnuplot</a> itself is not.<br/>
 <a class="el" href="likwid-agent.html"><code>likwid-agent</code></a> provided multiple backends to output the periodically measured data. The syslog backend requires the shell tool <em>logger</em> to be installed. The <a href="https://oss.oetiker.ch/rrdtool/">RRD</a> backend requires <em>rrdtool</em> and the GMetric backend the <em>gmetric</em> tool, part of the <a href="http://ganglia.sourceforge.net/">Ganglia Monitoring System</a>.<br/>
 In order to create the HTML documentation of LIKWID, the tool <a href="www.doxygen.org">Doxygen</a> is required. </p>
</div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Thu Nov 5 2015 10:35:52 for LIKWID by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
